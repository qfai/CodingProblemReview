# Database

### 索引方法
1. 顺序索引(稠密索引和稀疏索引)
2. B 树，MySQL用的B+树，MongoDB用的B树
3. hash索引：哈希索引必须要匹配所有的关键词，才能使用索引，因为哈希值是由所有的关键词共同来实现的。而B+树索引，是分层索引，可以先匹配第一个关键词，再匹配第二个关键词。但是不能跨级索引，比如没有第一个关键词，直接通过第二个关键词索引。在InnoDB引擎使用的是B+树索引，但是会自动为查询频繁的数据建立一个哈希索引，提高效率。
#### 为什么选择B树？

1. 对于数据库查找，索引的文件都存在磁盘上，磁盘IO的是非常消耗时间的，因此要减少磁盘IO的次数，而B数相比于二叉树，或者其变种AVL和RD-Tree的高度更低，因此磁盘IO的次数更好； 
2. B数是平衡树，查找，删除和插入是相对稳定的。

#### [为什么选择B+树](https://mp.weixin.qq.com/s?__biz=MzI1MTIzMzI2MA==&mid=2650561244&idx=1&sn=df3abafd3aa2f5a3abfe507bfc26982f&chksm=f1feec5fc6896549f89cbb82ee3d8010c63da76814030b285fa29322795de512ccca207064ee&mpshare=1&scene=1&srcid=0808vEJ8IjlSjZOUPs3xA20m&pass_ticket=1D74/xbCpltZzYXLI4sJssGpef7YU1ldKrGz/vIh0Hh1y313oWzky/HmgVUx8xsu#rd) 
1. B+树所有的数据都保存在叶节点上，查找数据都必须到达叶子节点，因此其查找效率是恒定的； 
2. B+树的叶子节点有指针指向下一个叶子节点，形成了一个链表。而叶子节点间又是排序的，因此对于范围查找只需要先找到头的位置，然后遍历链表就可以了； 
3. B+树的非叶子节点不需要存储数据，只作为索引，因此B+数的阶数可以更高，故单个节点保存的数据个数会更多，使得B+树更加矮胖，因此磁盘IO的次数会更少。


### InnoDB，MyISAM区别

1. InnoDB**支持事务**，MyISAM不支持，对于InnoDB每一条SQL语言都默认封装成事务，自动提交，这样会影响速度，所以最好把多条SQL语言放在begin和commit之间，组成一个事务；

2. InnoDB**支持外键**，而MyISAM不支持。对一个包含外键的InnoDB表转为MYISAM会失败；

3. InnoDB是聚集索引，数据文件是和索引绑在一起的，必须要有主键，通过主键索引效率很高。但是辅助索引需要两次查询，先查询到主键，然后再通过主键查询到数据。因此，主键不应该过大，因为主键太大，其他索引也都会很大。而MyISAM是非聚集索引，数据文件是分离的，索引保存的是数据文件的指针。主键索引和辅助索引是独立的。

4. InnoDB不保存表的具体行数，执行select count(*) from table时需要全表扫描。而MyISAM用一个变量保存了整个表的行数，执行上述语句时只需要读出该变量即可，速度很快；

5. Innodb不支持**全文索引**，而MyISAM支持全文索引，查询效率上MyISAM要高；

6. Innodb锁的粒度更细，支持行锁，MyISAM不支持。

 